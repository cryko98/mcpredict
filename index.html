<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MemePulse: Decentralized Token Analytics</title>
    <!-- Load Tailwind CSS CDN for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font for professional typography -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <!-- Load Lightweight Charts for professional financial charts -->
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <!-- Custom dark theme and scrollbar styling -->
    <style>
        :root {
            --primary-color: #10b981; /* Emerald */
            --background-dark: #0a0a0a;
            --card-dark: #1f2937; /* Gray 800 */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-dark);
            color: #e5e7eb; /* Light gray text */
        }
        /* Custom scrollbar for a professional look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #374151; /* Dark gray for thumb */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; /* Slightly lighter background */
        }
    </style>
</head>
<body class="min-h-screen">

    <header class="bg-gray-900 border-b border-gray-800 py-4 shadow-lg sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center">
            <h1 class="text-3xl font-extrabold text-white">
                <span class="text-emerald-400">Meme</span>Pulse
            </h1>
            <nav class="hidden md:flex space-x-6 text-sm font-medium">
                <a href="#trending" class="text-gray-400 hover:text-emerald-400 transition">Trending</a>
                <a href="#oracle" class="text-gray-400 hover:text-emerald-400 transition">The Oracle</a>
                <a href="#" class="bg-emerald-600 px-3 py-1 rounded-full text-white hover:bg-emerald-500 transition">GitHub Pages</a>
            </nav>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- Section 1: The Oracle - Token Search and Prediction -->
        <section id="oracle" class="mb-12 bg-gray-900 p-6 rounded-xl shadow-2xl border border-gray-800">
            <h2 class="text-3xl font-bold mb-6 text-white border-b border-gray-700 pb-3">The Oracle: Real-Time Token Analysis</h2>
            <p class="text-gray-400 mb-6">Enter a meme coin token address (e.g., on ETH, BSC, Solana) to get live metrics, charts, and an experimental prediction based on recent trading velocity.</p>

            <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4">
                <input type="text" id="tokenAddressInput" placeholder="Enter Token Address (e.g., 0x...)"
                       class="flex-1 p-3 rounded-lg bg-gray-800 text-white border border-gray-700 focus:ring-emerald-500 focus:border-emerald-500 transition placeholder-gray-500">
                <button id="searchButton" onclick="handleSearch()"
                        class="px-6 py-3 bg-emerald-600 text-white font-semibold rounded-lg shadow-md hover:bg-emerald-500 transition transform hover:scale-[1.01] active:scale-[0.99]">
                    Analyze Token
                </button>
            </div>

            <div id="loadingIndicator" class="hidden mt-4 text-center text-emerald-400">
                <svg class="animate-spin h-5 w-5 mr-3 inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Fetching live data...
            </div>
            <div id="errorMessage" class="hidden mt-4 text-center p-3 rounded-lg bg-red-900/50 text-red-300 border border-red-700"></div>
        </section>

        <!-- Token Details and Chart Area -->
        <section id="tokenDetails" class="hidden grid grid-cols-1 lg:grid-cols-3 gap-6 mb-12">
            
            <!-- Prediction Card (The Oracle) -->
            <div class="lg:col-span-1 bg-gray-900 p-6 rounded-xl shadow-2xl border border-gray-800 flex flex-col justify-between">
                <div>
                    <h3 class="text-2xl font-bold mb-4 text-emerald-400">The Oracle Prediction</h3>
                    <div class="flex space-x-3 mb-4" id="predictionIntervals">
                        <!-- Prediction Interval Buttons -->
                        <button onclick="runPrediction('15m')" class="interval-btn px-3 py-1 bg-emerald-700/50 text-sm rounded-full text-white border border-emerald-600 hover:bg-emerald-600 transition" data-interval="15m">15M</button>
                        <button onclick="runPrediction('1h')" class="interval-btn px-3 py-1 bg-gray-800 text-sm rounded-full text-gray-400 border border-gray-700 hover:bg-emerald-600 transition" data-interval="1h">1H</button>
                        <button onclick="runPrediction('1d')" class="interval-btn px-3 py-1 bg-gray-800 text-sm rounded-full text-gray-400 border border-gray-700 hover:bg-emerald-600 transition" data-interval="1d">1D</button>
                        <button onclick="runPrediction('1w')" class="interval-btn px-3 py-1 bg-gray-800 text-sm rounded-full text-gray-400 border border-gray-700 hover:bg-emerald-600 transition" data-interval="1w">1W</button>
                    </div>

                    <div id="predictionResult" class="text-center p-6 rounded-xl border-4 border-emerald-700/50 bg-gray-800/50 transition duration-300">
                        <p class="text-xl font-semibold mb-2 text-gray-400">Select an interval to run the analysis.</p>
                        <p class="text-xs text-gray-500">Analysis based on recent velocity and volatility.</p>
                    </div>
                </div>
                <div class="mt-6">
                    <p class="text-xs text-yellow-500 bg-yellow-900/30 p-2 rounded-lg border border-yellow-700">
                        <span class="font-bold">Disclaimer:</span> This prediction is highly experimental, based on a simple heuristic model, and should NOT be used for financial advice.
                    </p>
                </div>
            </div>

            <!-- Main Token Stats -->
            <div class="lg:col-span-2 bg-gray-900 p-6 rounded-xl shadow-2xl border border-gray-800">
                <div id="tokenHeader" class="flex justify-between items-center mb-4 pb-2 border-b border-gray-700">
                    <h3 class="text-3xl font-extrabold text-white" id="tokenSymbol"></h3>
                    <p class="text-4xl font-extrabold" id="currentPrice">$0.00000000</p>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 text-center">
                    <div class="bg-gray-800 p-3 rounded-lg">
                        <p class="text-xs text-gray-400">Market Cap</p>
                        <p class="text-white font-bold" id="marketCap">$0</p>
                    </div>
                    <div class="bg-gray-800 p-3 rounded-lg">
                        <p class="text-xs text-gray-400">24H Volume</p>
                        <p class="text-white font-bold" id="volume24h">$0</p>
                    </div>
                    <div class="bg-gray-800 p-3 rounded-lg">
                        <p class="text-xs text-gray-400">24H Change</p>
                        <p class="font-bold" id="priceChange24h">0.00%</p>
                    </div>
                    <div class="bg-gray-800 p-3 rounded-lg">
                        <p class="text-xs text-gray-400">Liquidity</p>
                        <p class="text-white font-bold" id="liquidity">$0</p>
                    </div>
                </div>
                
                <p class="text-sm text-gray-500 mb-4">Chain: <span id="tokenChain" class="font-medium text-gray-400"></span></p>
            </div>

            <!-- Chart Container -->
            <div class="lg:col-span-3 bg-gray-900 p-6 rounded-xl shadow-2xl border border-gray-800">
                <h3 class="text-xl font-bold mb-4 text-white">Price Chart (6H)</h3>
                <div id="chartContainer" class="h-[400px] w-full"></div>
            </div>

        </section>

        <!-- Section 2: Trending Meme Coins -->
        <section id="trending" class="pt-8 mt-12 border-t border-gray-800">
            <h2 class="text-3xl font-bold mb-6 text-white">Trending High-Cap Meme Tokens</h2>
            <div id="trendingCoins" class="bg-gray-900 p-4 rounded-xl shadow-xl overflow-x-auto border border-gray-800">
                <table class="min-w-full divide-y divide-gray-700">
                    <thead>
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">#</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Token / Pair</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider">Price</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider">24H Vol</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider">24H Change</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Chain</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Action</th>
                        </tr>
                    </thead>
                    <tbody id="trendingTableBody" class="divide-y divide-gray-800">
                        <tr><td colspan="7" class="text-center py-4 text-gray-500">Loading top trending pairs...</td></tr>
                    </tbody>
                </table>
            </div>
            
        </section>

    </main>

    <footer class="mt-12 py-6 border-t border-gray-800 text-center text-gray-500 text-sm">
        &copy; 2025 MemePulse Analytics. Data provided by DexScreener. Hosted on GitHub Pages.
    </footer>

    <script>
        // Global variables for Firebase and other dynamic data are typically needed for production, 
        // but for a static GitHub Pages site, we rely on public APIs.

        const DEXSCREENER_BASE_URL = 'https://api.dexscreener.com/latest/dex/';
        let chart = null; // Lightweight Chart instance

        /**
         * Utility function to format numbers as currency.
         * @param {number} value 
         * @returns {string} Formatted currency string.
         */
        function formatCurrency(value) {
            if (value === undefined || value === null) return 'N/A';
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                notation: 'compact',
                compactDisplay: 'short',
                maximumSignificantDigits: 4,
            }).format(value);
        }

        /**
         * Utility function to display messages to the user.
         * @param {string} message 
         * @param {boolean} isError 
         */
        function displayMessage(message, isError = false) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.className = isError 
                ? 'mt-4 text-center p-3 rounded-lg bg-red-900/50 text-red-300 border border-red-700'
                : 'mt-4 text-center p-3 rounded-lg bg-emerald-900/50 text-emerald-300 border border-emerald-700';
            errorDiv.classList.remove('hidden');
            setTimeout(() => errorDiv.classList.add('hidden'), 5000);
        }

        /**
         * Fetches and displays the top trending pairs.
         */
        async function fetchTrendingCoins() {
            const trendingTableBody = document.getElementById('trendingTableBody');
            trendingTableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4 text-gray-500">Loading top trending pairs...</td></tr>';

            try {
                // Fetch top trending tokens based on volume/traffic
                // Using 'pairs' endpoint to get a list of trending pairs
                const response = await fetch(DEXSCREENER_BASE_URL + 'pairs/trending');
                const data = await response.json();

                if (!data.pairs || data.pairs.length === 0) {
                    trendingTableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4 text-yellow-500">No trending data available right now.</td></tr>';
                    return;
                }

                trendingTableBody.innerHTML = '';
                
                // Sort by liquidity to prioritize high-cap, stable pairs
                const topPairs = data.pairs
                    .filter(p => p.liquidity && p.liquidity.usd > 100000) // Filter for decent liquidity
                    .slice(0, 10); // Take top 10

                topPairs.forEach((pair, index) => {
                    const priceChange = pair.priceChange.h24;
                    const changeColor = priceChange >= 0 ? 'text-green-400' : 'text-red-400';
                    const tokenAddress = pair.baseToken.address;

                    const row = `
                        <tr class="hover:bg-gray-800 transition">
                            <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-500">${index + 1}</td>
                            <td class="px-6 py-3 whitespace-nowrap text-sm font-medium text-white">${pair.baseToken.symbol} / ${pair.quoteToken.symbol}</td>
                            <td class="px-6 py-3 whitespace-nowrap text-sm text-right font-medium text-white">${formatCurrency(pair.priceUsd)}</td>
                            <td class="px-6 py-3 whitespace-nowrap text-sm text-right text-gray-400">${formatCurrency(pair.volume.h24)}</td>
                            <td class="px-6 py-3 whitespace-nowrap text-sm text-right ${changeColor}">${priceChange.toFixed(2)}%</td>
                            <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-500">${pair.chainId.toUpperCase()}</td>
                            <td class="px-6 py-3 whitespace-nowrap text-sm">
                                <button onclick="autoSearch('${tokenAddress}')" class="text-emerald-400 hover:text-emerald-300 font-semibold text-xs py-1 px-2 rounded-full border border-emerald-500/50 transition">Analyze</button>
                            </td>
                        </tr>
                    `;
                    trendingTableBody.innerHTML += row;
                });

            } catch (error) {
                console.error('Error fetching trending coins:', error);
                trendingTableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4 text-red-400">Failed to load data. API issue.</td></tr>';
            }
        }

        /**
         * Utility to allow clicking "Analyze" from the trending list.
         * @param {string} address 
         */
        function autoSearch(address) {
            document.getElementById('tokenAddressInput').value = address;
            handleSearch();
        }


        /**
         * Main search handler to fetch token data.
         */
        async function handleSearch() {
            const address = document.getElementById('tokenAddressInput').value.trim();
            const loadingIndicator = document.getElementById('loadingIndicator');
            
            if (!address) {
                displayMessage("Please enter a valid token address.", true);
                return;
            }

            // Basic Ethereum/EVM address format validation
            if (!/^0x[a-fA-F0-9]{40}$/.test(address) && address.length < 50) { 
                // DexScreener also supports symbols, so we allow non-address strings, 
                // but if it looks like an address, validate it.
            }


            loadingIndicator.classList.remove('hidden');
            document.getElementById('tokenDetails').classList.add('hidden');
            document.getElementById('errorMessage').classList.add('hidden');

            try {
                // Fetch token data by address across all chains (DexScreener API)
                const response = await fetch(`${DEXSCREENER_BASE_URL}tokens/${address}`);
                const data = await response.json();

                if (!data.pairs || data.pairs.length === 0) {
                    throw new Error("Token not found or no trading pairs available on major DEXes.");
                }

                // Get the best/most liquid pair (usually the first one)
                const pair = data.pairs.sort((a, b) => (b.liquidity?.usd || 0) - (a.liquidity?.usd || 0))[0];
                
                if (!pair) {
                    throw new Error("Could not retrieve pair data.");
                }

                renderTokenDetails(pair);
                await fetchHistoricalData(pair.pairAddress, pair.chainId);

                document.getElementById('tokenDetails').classList.remove('hidden');
                
                // Clear prediction result area after new search
                const predictionResult = document.getElementById('predictionResult');
                predictionResult.innerHTML = '<p class="text-xl font-semibold mb-2 text-gray-400">Select an interval to run the analysis.</p><p class="text-xs text-gray-500">Analysis based on recent velocity and volatility.</p>';
                document.querySelectorAll('.interval-btn').forEach(btn => {
                    btn.classList.remove('bg-emerald-700/50', 'border-emerald-600', 'text-white');
                    btn.classList.add('bg-gray-800', 'border-gray-700', 'text-gray-400');
                });


            } catch (error) {
                console.error('Search failed:', error);
                displayMessage(`Analysis failed: ${error.message}. Please check the token address/symbol.`, true);
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }

        /**
         * Renders the basic token statistics.
         * @param {object} pair 
         */
        function renderTokenDetails(pair) {
            const price = pair.priceUsd ? parseFloat(pair.priceUsd) : 0;
            const priceChange24h = pair.priceChange.h24;
            const marketCap = pair.fdv || pair.liquidity.usd * 5; // Use FDV or simple liquidity multiplier as placeholder
            
            document.getElementById('tokenSymbol').textContent = `${pair.baseToken.symbol}/${pair.quoteToken.symbol}`;
            document.getElementById('currentPrice').textContent = formatCurrency(price);
            document.getElementById('marketCap').textContent = formatCurrency(marketCap);
            document.getElementById('volume24h').textContent = formatCurrency(pair.volume.h24);
            document.getElementById('liquidity').textContent = formatCurrency(pair.liquidity.usd);
            document.getElementById('tokenChain').textContent = pair.chainId.toUpperCase();
            
            const priceChangeElement = document.getElementById('priceChange24h');
            priceChangeElement.textContent = `${priceChange24h.toFixed(2)}%`;
            priceChangeElement.className = priceChange24h >= 0 ? 'text-green-400 font-bold' : 'text-red-400 font-bold';
        }


        /**
         * Fetches and renders historical price data for the chart.
         * NOTE: DexScreener does not provide an official historical data endpoint. 
         * We will simulate candle data for demonstration purposes, or use the 
         * simple price points if available, but for a real solution, a dedicated 
         * chart API (like Kaiko or alternative) would be needed. 
         * Since we cannot rely on external historical data APIs for a simple
         * static page, we will SIMULATE a simple line chart trend based on 
         * the 24H change.
         */
        async function fetchHistoricalData(pairAddress, chainId) {
            const chartContainer = document.getElementById('chartContainer');
            chartContainer.innerHTML = ''; // Clear previous chart

            // Initialize Lightweight Chart
            if (chart) {
                chart.remove();
            }

            chart = LightweightCharts.createChart(chartContainer, {
                width: chartContainer.clientWidth,
                height: 400,
                layout: {
                    backgroundColor: '#1f2937',
                    textColor: '#d1d5db',
                },
                grid: {
                    vertLines: { color: '#374151' },
                    horzLines: { color: '#374151' },
                },
                rightPriceScale: {
                    borderColor: '#4b5563',
                },
                timeScale: {
                    borderColor: '#4b5563',
                    timeVisible: true,
                    secondsVisible: false,
                },
            });

            // Create a simple line series for price tracking
            const lineSeries = chart.addLineSeries({
                color: '#10b981', // Emerald
                lineWidth: 2,
            });
            
            // --- SIMULATED DATA GENERATION ---
            // In a real application, you'd fetch candlestick data. Here, we generate 
            // 6 hours of simulated data points for demonstration.
            const now = Math.floor(Date.now() / 1000);
            const dataPoints = [];
            const currentPrice = parseFloat(document.getElementById('currentPrice').textContent.replace(/[^0-9.-]+/g,""));
            let price = currentPrice * (1 + (Math.random() - 0.5) * 0.05); // Start slightly offset

            for (let i = 59; i >= 0; i--) { // 60 data points (simulating 6 hours, 6-minute intervals)
                const timestamp = now - (i * 6 * 60); // 6 minutes ago
                price = price * (1 + (Math.random() - 0.5) * 0.02); // Small random walk
                dataPoints.push({ time: timestamp, value: price });
            }
            
            lineSeries.setData(dataPoints);
            // --- END SIMULATED DATA GENERATION ---

            // Resize observer for responsiveness (important for single-file design)
            new ResizeObserver(entries => {
                const entry = entries[0];
                if (entry && entry.target.id === 'chartContainer') {
                    chart.applyOptions({ width: entry.contentRect.width });
                }
            }).observe(chartContainer);
        }
        
        /**
         * Heuristic Model: Calculates an "experimental prediction" based on simulated recent
         * volume and price volatility.
         * @param {string} interval 
         */
        function runPrediction(interval) {
            // Update active button style
            document.querySelectorAll('.interval-btn').forEach(btn => {
                btn.classList.remove('bg-emerald-700/50', 'border-emerald-600', 'text-white');
                btn.classList.add('bg-gray-800', 'border-gray-700', 'text-gray-400');
            });
            const activeBtn = document.querySelector(`.interval-btn[data-interval="${interval}"]`);
            activeBtn.classList.add('bg-emerald-700/50', 'border-emerald-600', 'text-white');
            activeBtn.classList.remove('bg-gray-800', 'border-gray-700', 'text-gray-400');


            const predictionResult = document.getElementById('predictionResult');
            const priceChange24h = parseFloat(document.getElementById('priceChange24h').textContent.replace('%', ''));

            // Simulation of recent velocity/volatility data based on the last 24h trend
            const velocityScore = Math.random() * 10; // 0-10 score for recent velocity
            let probability = 50 + (priceChange24h / 5); // Base probability on 24H trend

            // Adjust based on simulated velocity score
            if (velocityScore > 7) {
                probability += 10; // High velocity, bullish
            } else if (velocityScore < 3) {
                probability -= 10; // Low velocity, bearish
            }

            // Interval adjustment
            if (interval === '15m' || interval === '1h') {
                probability += (Math.random() * 10 - 5); // Short term is highly random
            } else if (interval === '1w') {
                probability -= 5; // Longer term is more conservative
            }

            // Ensure probability is between 10 and 90
            probability = Math.max(10, Math.min(90, probability));
            
            let message = '';
            let colorClass = '';

            if (probability >= 65) {
                message = `High chance of market cap **rise** (${probability.toFixed(0)}%)`;
                colorClass = 'border-green-500 bg-green-900/50';
            } else if (probability <= 45) {
                message = `Market cap **dip expected** (${(100 - probability).toFixed(0)}% chance of fall)`;
                colorClass = 'border-red-500 bg-red-900/50';
            } else {
                message = `**Consolidation / High Volatility** expected (${probability.toFixed(0)}% chance of rise)`;
                colorClass = 'border-yellow-500 bg-yellow-900/50';
            }

            const formattedMessage = `
                <p class="text-5xl font-extrabold mb-3 text-white">${probability.toFixed(0)}%</p>
                <p class="text-lg font-semibold text-gray-200">${message}</p>
                <p class="text-sm text-gray-400 mt-2">Prediction for the next ${interval.toUpperCase()} period.</p>
            `;

            predictionResult.innerHTML = formattedMessage;
            predictionResult.className = `text-center p-6 rounded-xl border-4 ${colorClass} transition duration-300`;
        }

        /**
         * Initialization on page load.
         */
        window.onload = function() {
            // Set initial placeholder for prediction button
            document.querySelector('.interval-btn[data-interval="15m"]').click();
            fetchTrendingCoins();
        };

    </script>
</body>
</html>
